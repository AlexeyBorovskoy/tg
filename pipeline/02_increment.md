# Pipeline: инкрементальная обработка и формирование отчётов

## 1. Требования
- Опрос источника: каждые 30 минут.
- Формирование сводки пользователю: 3 раза в день по МСК, только при наличии новых сообщений.
- Итоговые ссылки на отчёты (OpenAI и GigaChat): в конце дня, только если файлы изменились.

## 2. Сущности
- Инкремент сообщений: новые сообщения с момента `last_msg_id`.
- Digest slot: отчёт по окну времени (или по накоплению с последнего слота).
- Daily report: итоговый отчёт за день.
- Compare report: сравнение двух LLM.

## 3. Управление “нет новых сообщений”
Если новых сообщений нет:
- digest не создаётся;
- уведомление пользователю не отправляется.

## 4. Стратегия курсоров
Минимальный вариант (текущий стенд):
- курсор по `msg_id` в `rpt.report_state`.

Рекомендуемый (на развитие):
- двойной курсор `(dt, msg_id)` для более строгой устойчивости при нетипичных msg_id.
